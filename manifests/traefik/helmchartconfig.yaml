apiVersion: helm.cattle.io/v1
kind: HelmChartConfig
metadata:
  name: traefik
  namespace: kube-system
spec:
  valuesContent: |-
    # Workaround: запускаємо Traefik на master-node (10.0.10.10), щоб він мав стабільний доступ
    # до Kubernetes API (10.43.0.1:443). На work-node зараз є "no route to host" до API,
    # через що Traefik не бачить Services/IngressRoute і повертає 404.
    nodeSelector:
      kubernetes.io/hostname: master-node

    # Critical fix: Pod-и (включно з Traefik) у вашому кластері мають проблеми з доступом
    # до kubernetes.default Service IP (10.43.0.1:443). Вказуємо Traefik прямий endpoint API.
    # 192.168.2.19:6443 — API server k3s у вашій мережі (див. prometheus job kubernetes-apiservers).
    additionalArguments:
      - "--providers.kubernetesingress.endpoint=https://192.168.2.19:6443"
      - "--providers.kubernetesingress.tls.insecureSkipVerify=true"
      - "--providers.kubernetescrd.endpoint=https://192.168.2.19:6443"
      - "--providers.kubernetescrd.tls.insecureSkipVerify=true"
