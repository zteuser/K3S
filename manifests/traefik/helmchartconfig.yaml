apiVersion: helm.cattle.io/v1
kind: HelmChartConfig
metadata:
  name: traefik
  namespace: kube-system
spec:
  valuesContent: |-
    # Workaround: запускаємо Traefik на master-node (10.0.10.10), щоб він мав стабільний доступ
    # до Kubernetes API (10.43.0.1:443). На work-node зараз є "no route to host" до API,
    # через що Traefik не бачить Services/IngressRoute і повертає 404.
    nodeSelector:
      kubernetes.io/hostname: master-node

    # Critical workaround: pod-network у вашому кластері має проблеми з доступом до Service IP
    # (включно з kubernetes.default 10.43.0.1:443). Запускаємо Traefik у hostNetwork, щоб він
    # використовував мережевий стек хоста (де kube-proxy правила для Service IP працюють).
    hostNetwork: true
    dnsPolicy: ClusterFirstWithHostNet

    # Порт метрик Traefik змінюємо з 9100 на 9102, щоб на master-node (hostNetwork) порт 9100
    # був вільний для node-exporter (інакше под node-exporter не планується: "didn't have free ports").
    ports:
      metrics:
        port: 9102
